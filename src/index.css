@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  /* Theme CSS variables - Light mode defaults */
  --color-bg-primary: #f3f4f6;
  --color-bg-secondary: #ffffff;
  --color-bg-tertiary: #e5e7eb;
  --color-bg-card: #ffffff;
  --color-bg-hover: #f9fafb;
  --color-text-primary: #1f2937;
  --color-text-secondary: #4b5563;
  --color-text-muted: #6b7280;
  --color-border: #d1d5db;
  --color-border-light: #e5e7eb;
}

/* Dark mode variables */
html.dark {
  --color-bg-primary: #1a1a2e;
  --color-bg-secondary: #16162a;
  --color-bg-tertiary: #1f2937;
  --color-bg-card: #374151;
  --color-bg-hover: #374151;
  --color-text-primary: rgba(255, 255, 255, 0.87);
  --color-text-secondary: #d1d5db;
  --color-text-muted: #9ca3af;
  --color-border: #4b5563;
  --color-border-light: #374151;
}

/* Light mode defaults */
html {
  color-scheme: light;
  color: var(--color-text-primary);
  background-color: var(--color-bg-primary);
}

/* Dark mode */
html.dark {
  color-scheme: dark;
}

body {
  margin: 0;
  min-height: 100vh;
}

/* Theme-aware component overrides */
/* These ensure components work in both light and dark mode */

/* Main app backgrounds */
html:not(.dark) .bg-gray-900 {
  background-color: #f3f4f6 !important;
}

html:not(.dark) .bg-gray-800 {
  background-color: #ffffff !important;
}

html:not(.dark) .bg-gray-700 {
  background-color: #f9fafb !important;
}

html:not(.dark) .bg-gray-750 {
  background-color: #f3f4f6 !important;
}

html:not(.dark) .bg-anki-dark {
  background-color: #f3f4f6 !important;
}

html:not(.dark) .bg-anki-darker {
  background-color: #e5e7eb !important;
}

/* Text colors for light mode - improved contrast */
html:not(.dark) .text-white {
  color: #111827 !important;
}

html:not(.dark) .text-gray-100 {
  color: #1f2937 !important;
}

html:not(.dark) .text-gray-200 {
  color: #374151 !important;
}

html:not(.dark) .text-gray-300 {
  color: #4b5563 !important;
}

html:not(.dark) .text-gray-400 {
  color: #6b7280 !important;
}

html:not(.dark) .text-gray-500 {
  color: #374151 !important;
}

html:not(.dark) .text-gray-600 {
  color: #1f2937 !important;
}

/* Border colors for light mode */
html:not(.dark) .border-gray-600 {
  border-color: #d1d5db !important;
}

html:not(.dark) .border-gray-700 {
  border-color: #e5e7eb !important;
}

html:not(.dark) .border-gray-800 {
  border-color: #f3f4f6 !important;
}

/* Ring colors for light mode */
html:not(.dark) .ring-gray-700 {
  --tw-ring-color: #d1d5db !important;
}

/* Input backgrounds for light mode */
html:not(.dark) input.bg-gray-700,
html:not(.dark) select.bg-gray-700,
html:not(.dark) textarea.bg-gray-700 {
  background-color: #f9fafb !important;
  border-color: #d1d5db !important;
  color: #1f2937 !important;
}

/* Button hover states for light mode */
html:not(.dark) .hover\:bg-gray-700:hover {
  background-color: #e5e7eb !important;
}

html:not(.dark) .hover\:bg-gray-600:hover {
  background-color: #d1d5db !important;
}

html:not(.dark) .hover\:bg-gray-500:hover {
  background-color: #9ca3af !important;
}

/* Selected/active states need to stand out */
html:not(.dark) .bg-blue-600 {
  background-color: #2563eb !important;
}

html:not(.dark) .bg-green-600 {
  background-color: #16a34a !important;
}

html:not(.dark) .text-blue-400 {
  color: #2563eb !important;
}

html:not(.dark) .text-green-400 {
  color: #16a34a !important;
}

/* Card viewer content should stay white in both modes */
html:not(.dark) .prose.bg-white {
  background-color: #ffffff !important;
  color: #1f2937 !important;
}

html:not(.dark) .prose.bg-gray-100 {
  background-color: #f3f4f6 !important;
  color: #1f2937 !important;
}

/* Settings panel modal backdrop */
html:not(.dark) .bg-black\/50 {
  background-color: rgba(0, 0, 0, 0.3) !important;
}

/* Card list items */
html:not(.dark) .bg-gray-800\/50 {
  background-color: rgba(255, 255, 255, 0.8) !important;
}

html:not(.dark) .bg-gray-700\/50 {
  background-color: rgba(249, 250, 251, 0.8) !important;
}

html:not(.dark) .bg-gray-800\/30 {
  background-color: rgba(255, 255, 255, 0.5) !important;
}

/* Shadow adjustments for light mode */
html:not(.dark) .shadow-black\/30 {
  --tw-shadow-color: rgba(0, 0, 0, 0.1) !important;
}

html:not(.dark) .shadow-black\/40 {
  --tw-shadow-color: rgba(0, 0, 0, 0.15) !important;
}

/* Suggested card explanation banner in light mode */
html:not(.dark) .from-green-900\/30 {
  --tw-gradient-from: rgba(20, 83, 45, 0.15) !important;
}

html:not(.dark) .to-emerald-900\/20 {
  --tw-gradient-to: rgba(6, 78, 59, 0.1) !important;
}

html:not(.dark) .text-green-200\/90 {
  color: rgba(22, 101, 52, 0.9) !important;
}

/* SVG chart text for light mode */
html:not(.dark) .fill-gray-500 {
  fill: #374151 !important;
}

html:not(.dark) svg line[stroke="#4B5563"] {
  stroke: #d1d5db !important;
}

html:not(.dark) svg line[stroke="#6B7280"] {
  stroke: #9ca3af !important;
}

/* Anki card styling */
.anki-card {
  @apply bg-white text-gray-900 rounded-lg p-6 shadow-lg;
}

.anki-card .cloze {
  @apply font-bold text-blue-600;
}

.anki-card .cloze-hint {
  @apply text-gray-500 italic;
}

/* Rich text editor */
.editor-content {
  @apply min-h-[100px] p-3 bg-white text-gray-900 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500;
}

.editor-content:focus {
  @apply border-blue-500;
}

.editor-content img {
  @apply max-w-full h-auto my-2 rounded;
}

/* TipTap rich text field editor - proper image containment */
.rich-text-field .ProseMirror {
  @apply overflow-hidden;
}

.rich-text-field .ProseMirror img {
  @apply max-w-full h-auto;
}

/* Resizable image wrapper - ensure block display for proper line breaks */
.rich-text-field .ProseMirror [data-node-view-wrapper] {
  @apply block my-2;
}

/* tiptap-extension-resizable-image styles */
.node-image {
  position: relative;
  display: inline-block;
}

.node-image.ProseMirror-selectednode {
  z-index: 1;
}

.image-component {
  position: relative;
  user-select: auto;
  display: inline-flex;
}

.image-component img {
  margin-bottom: 0;
}

.image-component img[data-keep-ratio]:not([data-keep-ratio="false"]) {
  object-fit: contain;
}

.image-component img[data-keep-ratio="false"] {
  object-fit: fill;
}

/* Show resize handles when image is selected */
.node-image.ProseMirror-selectednode .image-resizer {
  display: block;
}

.node-image.ProseMirror-selectednode .image-component {
  outline: 2px solid rgb(60, 132, 244);
}

/* Resize handle styling */
.image-component .image-resizer {
  --box-size: 14px;
  --resizer-offset: calc(var(--box-size) / 2 + 1px);
  z-index: 2;
  display: none;
  width: var(--box-size);
  height: var(--box-size);
  position: absolute;
  background-color: rgb(60, 132, 244);
  border: 2px solid #fff;
  border-radius: 50%;
}

.image-component .image-resizer.image-resizer-n {
  inset: calc(var(--resizer-offset) * -1) 0 auto;
  margin: auto;
  cursor: n-resize;
}

.image-component .image-resizer.image-resizer-ne {
  top: calc(var(--resizer-offset) * -1);
  right: calc(var(--resizer-offset) * -1);
  cursor: ne-resize;
}

.image-component .image-resizer.image-resizer-e {
  right: calc(var(--resizer-offset) * -1);
  top: 0;
  bottom: 0;
  margin: auto;
  cursor: e-resize;
}

.image-component .image-resizer.image-resizer-se {
  bottom: calc(var(--resizer-offset) * -1);
  right: calc(var(--resizer-offset) * -1);
  cursor: nwse-resize;
}

.image-component .image-resizer.image-resizer-s {
  inset: auto 0 calc(var(--resizer-offset) * -1);
  margin: auto;
  cursor: s-resize;
}

.image-component .image-resizer.image-resizer-sw {
  bottom: calc(var(--resizer-offset) * -1);
  left: calc(var(--resizer-offset) * -1);
  cursor: sw-resize;
}

.image-component .image-resizer.image-resizer-w {
  left: calc(var(--resizer-offset) * -1);
  top: 0;
  bottom: 0;
  margin: auto;
  cursor: w-resize;
}

.image-component .image-resizer.image-resizer-nw {
  top: calc(var(--resizer-offset) * -1);
  left: calc(var(--resizer-offset) * -1);
  cursor: nw-resize;
}

/* TipTap list styling - ensure bullets and numbers are visible */
.rich-text-field .ProseMirror ul {
  @apply list-disc pl-6 my-2;
}

.rich-text-field .ProseMirror ol {
  @apply list-decimal pl-6 my-2;
}

.rich-text-field .ProseMirror li {
  @apply my-1;
}

.rich-text-field .ProseMirror li p {
  @apply my-0;
}

/* Tree view */
.tree-item {
  @apply cursor-pointer rounded px-2 py-1 transition-colors;
}

html.dark .tree-item {
  @apply hover:bg-gray-700;
}

html:not(.dark) .tree-item {
  @apply hover:bg-gray-200;
}

.tree-item.selected {
  @apply bg-blue-600 hover:bg-blue-700 text-white;
}

/* Scrollbar styling - Dark mode */
html.dark ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

html.dark ::-webkit-scrollbar-track {
  @apply bg-gray-800;
}

html.dark ::-webkit-scrollbar-thumb {
  @apply bg-gray-600 rounded;
}

html.dark ::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-500;
}

/* Scrollbar styling - Light mode */
html:not(.dark) ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

html:not(.dark) ::-webkit-scrollbar-track {
  @apply bg-gray-200;
}

html:not(.dark) ::-webkit-scrollbar-thumb {
  @apply bg-gray-400 rounded;
}

html:not(.dark) ::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-500;
}

/* Loading spinner */
.spinner {
  @apply animate-spin rounded-full border-4 border-gray-300 border-t-blue-500;
}

/* Editable field placeholder */
.editor-content:empty:before {
  content: attr(data-placeholder);
  @apply text-gray-500 italic;
  pointer-events: none;
}

/* Editable field in dark mode */
html.dark .editor-content {
  @apply bg-gray-800 text-gray-100 border-gray-600;
}

html.dark .editor-content:focus {
  @apply border-blue-500;
}

/* Editable field in light mode */
html:not(.dark) .editor-content {
  @apply bg-white text-gray-900 border-gray-300;
}

html:not(.dark) .editor-content:focus {
  @apply border-blue-500;
}