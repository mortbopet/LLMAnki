// Anki protobuf definitions for database schema
// Based on https://github.com/ankitects/anki/tree/main/proto/anki
// License: GNU AGPL, version 3 or later

syntax = "proto3";

package anki;

// ============= Notetype Config =============
// From notetypes.proto - Notetype.Config

message NotetypeConfig {
  enum Kind {
    KIND_NORMAL = 0;
    KIND_CLOZE = 1;
  }
  
  message CardRequirement {
    enum Kind {
      KIND_NONE = 0;
      KIND_ANY = 1;
      KIND_ALL = 2;
    }
    uint32 card_ord = 1;
    Kind kind = 2;
    repeated uint32 field_ords = 3;
  }

  Kind kind = 1;
  uint32 sort_field_idx = 2;
  string css = 3;
  int64 target_deck_id_unused = 4;
  string latex_pre = 5;
  string latex_post = 6;
  bool latex_svg = 7;
  repeated CardRequirement reqs = 8;
  uint32 original_stock_kind = 9;
  optional int64 original_id = 10;
  bytes other = 255;
}

// ============= Field Config =============
// From notetypes.proto - Notetype.Field.Config

message NoteFieldConfig {
  bool sticky = 1;
  bool rtl = 2;
  string font_name = 3;
  uint32 font_size = 4;
  string description = 5;
  bool plain_text = 6;
  bool collapsed = 7;
  bool exclude_from_search = 8;
  optional int64 id = 9;
  optional uint32 tag = 10;
  bool prevent_deletion = 11;
  bytes other = 255;
}

// ============= Template Config =============
// From notetypes.proto - Notetype.Template.Config

message CardTemplateConfig {
  string q_format = 1;
  string a_format = 2;
  string q_format_browser = 3;
  string a_format_browser = 4;
  int64 target_deck_id = 5;
  string browser_font_name = 6;
  uint32 browser_font_size = 7;
  optional int64 id = 8;
  bytes other = 255;
}

// ============= Deck Common =============
// From decks.proto - Deck.Common

message DeckCommon {
  bool study_collapsed = 1;
  bool browser_collapsed = 2;
  uint32 last_day_studied = 3;
  int32 new_studied = 4;
  int32 review_studied = 5;
  int32 learning_studied = 6;
  int32 milliseconds_studied = 7;
  bytes other = 255;
}

// ============= Deck Normal =============
// From decks.proto - Deck.Normal

message DeckNormal {
  message DayLimit {
    uint32 limit = 1;
    uint32 today = 2;
  }
  
  int64 config_id = 1;
  uint32 extend_new = 2;
  uint32 extend_review = 3;
  string description = 4;
  bool markdown_description = 5;
  optional uint32 review_limit = 6;
  optional uint32 new_limit = 7;
  DayLimit review_limit_today = 8;
  DayLimit new_limit_today = 9;
  optional float desired_retention = 10;
}

// ============= Deck Kind Container =============
// From decks.proto - Deck.KindContainer

message DeckKindContainer {
  oneof kind {
    DeckNormal normal = 1;
    DeckFiltered filtered = 2;
  }
}

// Filtered deck (simplified)
message DeckFiltered {
  message SearchTerm {
    enum Order {
      OLDEST_REVIEWED_FIRST = 0;
      RANDOM = 1;
      INTERVALS_ASCENDING = 2;
      INTERVALS_DESCENDING = 3;
      LAPSES = 4;
      ADDED = 5;
      DUE = 6;
      REVERSE_ADDED = 7;
      RETRIEVABILITY_ASCENDING = 8;
      RETRIEVABILITY_DESCENDING = 9;
    }
    string search = 1;
    uint32 limit = 2;
    Order order = 3;
  }
  
  bool reschedule = 1;
  repeated SearchTerm search_terms = 2;
  repeated float delays = 3;
  uint32 preview_delay = 4;
  uint32 preview_good_secs = 6;
  uint32 preview_again_secs = 7;
  uint32 preview_hard_secs = 5;
}

// ============= Deck Config =============
// From deck_config.proto - DeckConfig.Config

message DeckConfigConfig {
  enum NewCardInsertOrder {
    NEW_CARD_INSERT_ORDER_DUE = 0;
    NEW_CARD_INSERT_ORDER_RANDOM = 1;
  }
  
  enum NewCardGatherPriority {
    NEW_CARD_GATHER_PRIORITY_DECK = 0;
    NEW_CARD_GATHER_PRIORITY_LOWEST_POSITION = 1;
    NEW_CARD_GATHER_PRIORITY_HIGHEST_POSITION = 2;
    NEW_CARD_GATHER_PRIORITY_RANDOM_NOTES = 3;
    NEW_CARD_GATHER_PRIORITY_RANDOM_CARDS = 4;
    NEW_CARD_GATHER_PRIORITY_DECK_THEN_RANDOM_NOTES = 5;
  }
  
  enum NewCardSortOrder {
    NEW_CARD_SORT_ORDER_TEMPLATE = 0;
    NEW_CARD_SORT_ORDER_NO_SORT = 1;
    NEW_CARD_SORT_ORDER_TEMPLATE_THEN_RANDOM = 2;
    NEW_CARD_SORT_ORDER_RANDOM_NOTE_THEN_TEMPLATE = 3;
    NEW_CARD_SORT_ORDER_RANDOM_CARD = 4;
  }
  
  enum ReviewCardOrder {
    REVIEW_CARD_ORDER_DAY = 0;
    REVIEW_CARD_ORDER_DAY_THEN_DECK = 1;
    REVIEW_CARD_ORDER_DECK_THEN_DAY = 2;
    REVIEW_CARD_ORDER_INTERVALS_ASCENDING = 3;
    REVIEW_CARD_ORDER_INTERVALS_DESCENDING = 4;
    REVIEW_CARD_ORDER_EASE_ASCENDING = 5;
    REVIEW_CARD_ORDER_EASE_DESCENDING = 6;
    REVIEW_CARD_ORDER_RETRIEVABILITY_ASCENDING = 7;
    REVIEW_CARD_ORDER_RANDOM = 8;
    REVIEW_CARD_ORDER_ADDED = 9;
    REVIEW_CARD_ORDER_REVERSE_ADDED = 10;
    REVIEW_CARD_ORDER_RETRIEVABILITY_DESCENDING = 11;
  }
  
  enum ReviewMix {
    REVIEW_MIX_MIX_WITH_REVIEWS = 0;
    REVIEW_MIX_AFTER_REVIEWS = 1;
    REVIEW_MIX_BEFORE_REVIEWS = 2;
  }
  
  enum LeechAction {
    LEECH_ACTION_SUSPEND = 0;
    LEECH_ACTION_TAG_ONLY = 1;
  }
  
  enum AnswerAction {
    ANSWER_ACTION_BURY_CARD = 0;
    ANSWER_ACTION_ANSWER_AGAIN = 1;
    ANSWER_ACTION_ANSWER_GOOD = 2;
    ANSWER_ACTION_ANSWER_HARD = 3;
    ANSWER_ACTION_SHOW_REMINDER = 4;
  }
  
  enum QuestionAction {
    QUESTION_ACTION_SHOW_ANSWER = 0;
    QUESTION_ACTION_SHOW_REMINDER = 1;
  }

  repeated float learn_steps = 1;
  repeated float relearn_steps = 2;
  repeated float fsrs_params_4 = 3;
  repeated float easy_days_percentages = 4;
  repeated float fsrs_params_5 = 5;
  repeated float fsrs_params_6 = 6;
  // reserved 7 to 8
  uint32 new_per_day = 9;
  uint32 reviews_per_day = 10;
  float initial_ease = 11;
  float easy_multiplier = 12;
  float hard_multiplier = 13;
  float lapse_multiplier = 14;
  float interval_multiplier = 15;
  uint32 maximum_review_interval = 16;
  uint32 minimum_lapse_interval = 17;
  uint32 graduating_interval_good = 18;
  uint32 graduating_interval_easy = 19;
  NewCardInsertOrder new_card_insert_order = 20;
  LeechAction leech_action = 21;
  uint32 leech_threshold = 22;
  bool disable_autoplay = 23;
  uint32 cap_answer_time_to_secs = 24;
  bool show_timer = 25;
  bool skip_question_when_replaying_answer = 26;
  bool bury_new = 27;
  bool bury_reviews = 28;
  bool bury_interday_learning = 29;
  ReviewMix new_mix = 30;
  ReviewMix interday_learning_mix = 31;
  NewCardSortOrder new_card_sort_order = 32;
  ReviewCardOrder review_order = 33;
  NewCardGatherPriority new_card_gather_priority = 34;
  uint32 new_per_day_minimum = 35;
  QuestionAction question_action = 36;
  float desired_retention = 37;
  bool stop_timer_on_answer = 38;
  // reserved 39
  float historical_retention = 40;
  float seconds_to_show_question = 41;
  float seconds_to_show_answer = 42;
  AnswerAction answer_action = 43;
  bool wait_for_audio = 44;
  string param_search = 45;
  string ignore_revlogs_before_date = 46;
  bytes other = 255;
}

// ============= Media Entries =============
// From import_export.proto - for media manifest

message MediaEntry {
  string name = 1;
  uint32 size = 2;
  bytes sha1 = 3;
  optional uint32 legacy_zip_filename = 255;
}

message MediaEntries {
  repeated MediaEntry entries = 1;
}
